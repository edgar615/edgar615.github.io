---
layout: post
title: dig命令
description: 
date: 2020-07-01
categories:
    - linux
comments: true
permalink: dig.html
---

Dig是一个在类Unix命令行模式下查询DNS包括NS记录，A记录，MX记录等相关信息的工具

# 1. DNS 记录的类型说明

- 类型A记录: A记录是指定域名对应的IP地址。
- 类型AAAA记录：该记录是将域名解析到一个指定的IPV6的IP上
- 类型CNAME记录：通常称别名解析。可以将注册的不同域名都转到一个域名记录上，由这个域名记录统一解析管理，与A记录不同的是，CNAME别名记录设置的可以是一个域名的描述而不一定是IP地址
- 类型NS记录: 域名服务器记录，如果需要把子域名交给其他 DNS 服务器解析，就需要添加 NS 记录。
- 类型MX记录 :如果需要设置邮箱，让邮箱能够收到邮件，需要添加 MX 记录。
- 类型TXT记录 : 可以写任何东西，长度限制为 255。绝大多数的 TXT记录是用来做 SPF 记录(反垃圾邮件)。

# 2. 语法

`dig [选项] (参数)`

选项

- @<服务器地址>：指定进行域名解析的域名服务器；
- -b<ip地址>：当主机具有多个IP地址，指定使用本机的哪个IP地址向域名服务器发送域名查询请求；
- -f<文件名称>：指定dig以批处理的方式运行，指定的文件中保存着需要批处理查询的DNS任务信息；
- -P：指定域名服务器所使用端口号；
- -t<类型>：指定要查询的DNS数据类型；
- -x<IP地址>：执行逆向域名查询；
- -4：使用IPv4；
- -6：使用IPv6；
- -h：显示指令帮助信息;

参数

- 主机：指定要查询域名主机；
- 查询类型：指定DNS查询的类型；
- 查询类：指定查询DNS的class；
- 查询选项：指定查询选项;

# 3. 示例
## 3.1. 查看主机信息

```
$ dig www.baidu.com

; <<>> DiG 9.9.5-3ubuntu0.19-Ubuntu <<>> www.baidu.com
;; global options: +cmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 12439
;; flags: qr rd ra; QUERY: 1, ANSWER: 3, AUTHORITY: 0, ADDITIONAL: 0

;; QUESTION SECTION:
;www.baidu.com.			IN	A

;; ANSWER SECTION:
www.baidu.com.		1156	IN	CNAME	www.a.shifen.com.
www.a.shifen.com.	213	IN	A	180.101.49.11
www.a.shifen.com.	213	IN	A	180.101.49.12

;; Query time: 33 msec
;; SERVER: 100.100.2.136#53(100.100.2.136)
;; WHEN: Wed Jul 29 17:08:01 CST 2020
;; MSG SIZE  rcvd: 90
```

dig 命令默认的输出信息可以分为 5 个部分。

- 第一部分显示 dig 命令的版本和输入的参数。可以通过`+[no]cmd`选项保留或删除
- 第二部分显示服务返回的一些技术详情，比较重要的是 status。如果 status 的值为 NOERROR 则说明本次查询成功结束。可以通`+[no]comments`选项保留或删除
- 第三部分中的 "QUESTION SECTION" 显示我们要查询的域名。可以用`+[no]question`选项保留或删除
- 第四部分的 "ANSWER SECTION" 是查询到的结果。可以通`+[no]answer`选项保留或删除
- 第五部分则是本次查询的一些统计信息，比如用了多长时间，查询了哪个 DNS 服务器，在什么时间进行的查询等等。可以用`+[no]stats`选项保留或删除

```
$ dig www.baidu.com +nostats +nocmd +noquestion

; <<>> DiG 9.9.5-3ubuntu0.19-Ubuntu <<>> www.baidu.com +nostats +nocmd +noquestion
;; global options: +cmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 6200
;; flags: qr rd ra; QUERY: 1, ANSWER: 3, AUTHORITY: 0, ADDITIONAL: 0

;; ANSWER SECTION:
www.baidu.com.		651	IN	CNAME	www.a.shifen.com.
www.a.shifen.com.	5	IN	A	180.101.49.11
www.a.shifen.com.	5	IN	A	180.101.49.12
```
