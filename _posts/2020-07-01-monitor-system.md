---
layout: post
title: 监控（1）- 监控系统的作用
date: 2020-07-01
categories:
    - 架构设计
comments: true
permalink: monitor-source.html
---

# 1. 监控系统的作用

- **实时采集监控数据**：包括硬件、操作系统、中间件、应用程序等各个维度的数据。
- **实时反馈监控状态**：通过对采集的数据进行多维度统计和可视化展示，能实时体现监控对象的状态是正常还是异常。
- **预知故障和告警：**能够提前预知故障风险，并及时发出告警信息。
- **保证服务可靠性安全性：**我们监控的目的就是要保证系统、服务、业务正常运行；
- **保证业务持续稳定运行：**如果我们的监控做得很完善，即使出现故障，能第一时间接收到故障报警，在第一时间处理解决，从而保证业务持续性的稳定运行。
- **辅助定位故障：**提供故障发生时的各项指标数据，辅助故障分析和定位。
- **辅助性能调优：**为性能调优提供数据支持，比如慢SQL，接口响应时间等。
- **辅助容量规划：**为服务器、中间件以及应用集群的容量规划提供数据支撑。
- **辅助自动化运维：**为自动扩容或者根据配置的SLA进行服务降级等智能运维提供数据支撑。

# 2. 如何使用监控系统

**出任何线上事故，先不说其他地方有问题，监控部分一定是有问题的。**

我们在事故复盘时，通常会思考这3个和监控有关的问题：有没有做监控？监控是否及时？监控信息是否有助于快速定位问题？可见光有一套好的监控系统还不够，还必须知道**如何用好它**。一个成熟的研发团队通常会定一个监控规范，用来统一监控系统的使用方法。

- **了解监控对象的工作原理：**要做到对监控对象有基本的了解，清楚它的工作原理。比如想对JVM进行监控，你必须清楚JVM的堆内存结构和垃圾回收机制。
- **确定监控对象的指标：**清楚使用哪些指标来刻画监控对象的状态？比如想对某个接口进行监控，可以采用请求量、耗时、超时量、异常量等指标来衡量。
- **定义合理的报警阈值和等级：**达到什么阈值需要告警？对应的故障等级是多少？不需要处理的告警不是好告警，可见定义合理的阈值有多重要，否则只会降低运维效率或者让监控系统失去它的作用。
- **建立完善的故障处理流程：**收到故障告警后，一定要有相应的处理流程和oncall机制，让故障及时被跟进处理。

# 3. 监控的核心

- 发现问题：当系统发生故障报警，我们会收到故障报警的信息。
- 定位问题：故障邮件一般都会写某某主机故障、具体故障的内容，我们需要对报警内容进行分析。比如一台服务器连不上，我们就需要考虑是网络问题、还是负载太高导致长时间无法连接，又或者某开发触发了防火墙禁止的相关策略等，我们就需要去分析故障具体原因。
- 解决问题：当然我们了解到故障的原因后，就需要通过故障解决的优先级去解决该故障。
- 总结问题：当我们解决完重大故障后，需要对故障原因以及防范进行总结归纳，避免以后重复出现。

# 4. 监控系统的基本流程

无论是开源的监控系统还是自研的监控系统，监控的整个流程大同小异，一般都包括以下模块：

- **数据采集：**采集的方式有很多种，包括日志埋点进行采集（通过Logstash、Filebeat等进行上报和解析），JMX标准接口输出监控指标，被监控对象提供REST API进行数据采集（如Hadoop、ES），系统命令行，统一的SDK进行侵入式的埋点和上报等。
- **数据传输：**将采集的数据以TCP、UDP或者HTTP协议的形式上报给监控系统，有主动Push模式，也有被动Pull模式。
- **数据存储：**有使用MySQL、Oracle等RDBMS存储的，也有使用时序数据库RRDTool、OpentTSDB、InfluxDB存储的，还有使用HBase存储的。
- **数据展示：**数据指标的图形化展示。
- **监控告警：**灵活的告警设置，以及支持邮件、短信、IM等多种通知通道。

# 5. 参考资料

https://mp.weixin.qq.com/s/VKPoZsveg_wzGv1FxCYcUg

https://mp.weixin.qq.com/s/FGCZws3bQ9l9zOWDRTfdhg