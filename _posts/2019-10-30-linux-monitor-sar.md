---
layout: post
title: Linux监控工具-sar
date: 2019-10-30
categories:
    - linux
comments: true
permalink: linux-monitor-sar.html
---

sar  可以全面地获取系统的CPU、运行队列、磁盘I/O、分页（交换区）、内存、CPU中断和网络等性能数据

**常用参数**

```
-u  ：显示系统所有CPU在采样时间内的使用情况
-d  ：显示系统所有硬盘设备在采样时间内的使用情况
-r  ：显示在采样时间内系统内存的使用情况
-b  ：显示I/O和传送速率的统计信息
-n  ：显示网络运行状态
-q  ：显示运行队列的大小，它与系统当时的平均负载相同
```

**CPU利用率**

sar -u 1 10 （1：每隔一秒，10：写入10次）

```
# sar -u 1 10
Linux 5.4.0-62-generic (server-1)       01/20/2021      _x86_64_        (4 CPU)

08:57:47 AM     CPU     %user     %nice   %system   %iowait    %steal     %idle
08:57:48 AM     all      0.00      0.00     29.67      9.97      0.00     60.36
08:57:49 AM     all      0.00      0.00      0.00      0.00      0.00    100.00
08:57:50 AM     all      0.00      0.00      0.00      0.00      0.00    100.00
08:57:51 AM     all      0.00      0.00      0.00      0.00      0.00    100.00
08:57:52 AM     all      0.52      0.00     40.94     17.59      0.00     40.94
08:57:53 AM     all      0.00      0.00     27.32     16.49      0.00     56.19
08:57:54 AM     all      0.00      0.00      0.25      0.00      0.00     99.75
08:57:55 AM     all      0.75      0.00      0.50      0.00      0.00     98.75
08:57:56 AM     all      0.00      0.00      0.25      0.00      0.00     99.75
08:57:57 AM     all      0.51      0.00     37.02     21.34      0.00     41.13
Average:        all      0.18      0.00     13.32      6.41      0.00     80.09

```

| **输出项** | **详细说明**                                                 |
| ---------- | ------------------------------------------------------------ |
| CPU        | all 表示统计信息为所有 CPU 的平均值。                        |
| %user      | 显示在用户级别(application)运行使用 CPU 总时间的百分比。     |
| %nice      | 显示在用户级别，用于nice操作，所占用 CPU 总时间的百分比。    |
| %system    | 在核心级别(kernel)运行所使用 CPU 总时间的百分比。            |
| %iowait    | 显示用于等待I/O操作占用 CPU 总时间的百分比。                 |
| %steal     | 管理程序(hypervisor)为另一个虚拟进程提供服务而等待虚拟 CPU 的百分比。 |
| %idle      | 显示 CPU 空闲时间占用 CPU 总时间的百分比。                   |

**内存利用率**

sar -r 1 10 （1：每隔一秒，10：写入10次）

```
# sar -r 1 10
Linux 5.4.0-62-generic (server-1)       01/20/2021      _x86_64_        (4 CPU)

08:59:25 AM kbmemfree   kbavail kbmemused  %memused kbbuffers  kbcached  kbcommit   %commit  kbactive   kbinact   kbdirty
08:59:26 AM   1201404   2746560    817976     20.44    158808   1481116   1804120     22.54   1196240   1091604       172
08:59:27 AM   1201356   2746512    817976     20.44    158808   1481116   1804120     22.54   1196240   1091604       172
08:59:28 AM   1331436   2876596    687928     17.19    158808   1481116   1672708     20.90   1065240   1091604       172
08:59:29 AM   1331436   2876604    687920     17.19    158816   1481116   1672708     20.90   1065292   1091604         0
08:59:30 AM   1331436   2876604    687920     17.19    158816   1481116   1672708     20.90   1065292   1091604         0
08:59:31 AM   1202144   2747312    817212     20.42    158816   1481116   1806636     22.57   1196124   1091604         0
08:59:32 AM   1202112   2747280    817212     20.42    158816   1481116   1806636     22.57   1196340   1091604         0
08:59:33 AM   1331028   2876196    688440     17.20    158816   1481116   1675556     20.94   1065508   1091604         0
08:59:34 AM   1331232   2876400    688164     17.20    158824   1481116   1675556     20.94   1065292   1091604       160
08:59:35 AM   1331232   2876400    688164     17.20    158824   1481116   1675556     20.94   1065292   1091604       160
Average:      1279482   2824646    739891     18.49    158815   1481116   1726630     21.57   1117686   1091604        84

```



| kbmemfree           | 这个值和free命令中的free值基本一致，所以它不包括buffer和cache的空间。 |
| ------------------- | ------------------------------------------------------------ |
| kbmemused           | 这个值和free命令中的used值基本一致，所以它包括buffer和cache的空间。 |
| %memused            | 这个值是kbmemused和内存总量(不包括swap)的一个百分比。        |
| kbbuffers和kbcached | 这两个值就是free命令中的buffer和cache。                      |
| kbcommit            | 保证当前系统所需要的内存，即为了确保不溢出而需要的内存(RAM+swap)。 |
| %commit             | 这个值是kbcommit与内存总量(包括swap)的一个百分比。           |

**磁盘I/O**

sar -d 1 2 （1：每隔一秒，2：写入2次）

```
# sar -d 1 2
Linux 5.4.0-62-generic (server-1)       01/20/2021      _x86_64_        (4 CPU)

09:00:24 AM       DEV       tps     rkB/s     wkB/s     dkB/s   areq-sz    aqu-sz     await     %util
09:00:25 AM    dev7-0      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
09:00:25 AM    dev7-1      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
09:00:25 AM    dev7-2      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
09:00:25 AM    dev7-3      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
09:00:25 AM    dev7-4      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
09:00:25 AM    dev7-5      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
09:00:25 AM    dev7-6      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
09:00:25 AM    dev2-0      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
09:00:25 AM   dev11-0      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
09:00:25 AM    dev8-0      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
09:00:25 AM  dev253-0      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00

09:00:25 AM       DEV       tps     rkB/s     wkB/s     dkB/s   areq-sz    aqu-sz     await     %util
09:00:26 AM    dev7-0      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
09:00:26 AM    dev7-1      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
09:00:26 AM    dev7-2      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
09:00:26 AM    dev7-3      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
09:00:26 AM    dev7-4      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
09:00:26 AM    dev7-5      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
09:00:26 AM    dev7-6      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
09:00:26 AM    dev2-0      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
09:00:26 AM   dev11-0      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
09:00:26 AM    dev8-0      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
09:00:26 AM  dev253-0      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00

Average:          DEV       tps     rkB/s     wkB/s     dkB/s   areq-sz    aqu-sz     await     %util
Average:       dev7-0      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
Average:       dev7-1      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
Average:       dev7-2      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
Average:       dev7-3      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
Average:       dev7-4      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
Average:       dev7-5      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
Average:       dev7-6      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
Average:       dev2-0      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
Average:      dev11-0      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
Average:       dev8-0      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
Average:     dev253-0      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00

```

| **输出项** | **详细说明**                                        |
| ---------- | --------------------------------------------------- |
| await      | 表示平均每次设备I/O操作的等待时间（以毫秒为单位）。 |
| svctm      | 表示平均每次设备I/O操作的服务时间（以毫秒为单位）。 |
| %util      | 表示一秒中有百分之几的时间用于I/O操作。             |

**网络流量**

sar -n DEV 1 2 （1：每隔一秒，2：写入2次）

```
# sar -n DEV 1 2
Linux 5.4.0-62-generic (server-1)       01/20/2021      _x86_64_        (4 CPU)

09:01:21 AM     IFACE   rxpck/s   txpck/s    rxkB/s    txkB/s   rxcmp/s   txcmp/s  rxmcst/s   %ifutil
09:01:22 AM br-6d212538ddbf      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
09:01:22 AM        lo      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
09:01:22 AM veth1046834      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
09:01:22 AM     ens33      2.00      2.00      0.12      0.20      0.00      0.00      0.00      0.00
09:01:22 AM   docker0      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00

09:01:22 AM     IFACE   rxpck/s   txpck/s    rxkB/s    txkB/s   rxcmp/s   txcmp/s  rxmcst/s   %ifutil
09:01:23 AM br-6d212538ddbf      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
09:01:23 AM        lo      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
09:01:23 AM veth1046834      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
09:01:23 AM     ens33      3.00      4.00      0.18      0.53      0.00      0.00      0.00      0.00
09:01:23 AM   docker0      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00

Average:        IFACE   rxpck/s   txpck/s    rxkB/s    txkB/s   rxcmp/s   txcmp/s  rxmcst/s   %ifutil
Average:    br-6d212538ddbf      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
Average:           lo      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
Average:    veth1046834      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
Average:        ens33      2.50      3.00      0.15      0.36      0.00      0.00      0.00      0.00
Average:      docker0      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00

```

| **输出项** | **详细说明**                   |
| ---------- | ------------------------------ |
| IFACE      | 就是网络设备的名称。           |
| rxpck/s    | 每秒钟接收到的包数目。         |
| txpck/s    | 每秒钟发送出去的包数目。       |
| rxkB/s     | 每秒钟接收到的字节数。         |
| txkB/s     | 每秒钟发送出去的字节数。       |
| rxcmp/s    | 每秒钟接收到的压缩包数目。     |
| txcmp/s    | 每秒钟发送出去的压缩包数目。   |
| rxmcst/s   | 每秒钟接收到的多播包的包数目。 |