---
layout: post
title: 高可用 - 设计要点
date: 2020-06-26
categories:
    - 架构设计
comments: true
permalink: ha-design.html
---

# 1. 设计层面

设计高可用方案时，我们需要考虑以下要点。

- 负载均衡： 是否可以通过加节点的方式水平分担读请求压力。

- 分片： 是否可以通过划分到不同的节点的方式水平分担写压力。

- 数据冗余： 一个节点的数据如果挂掉了，其他节点的数据是否可以直接备份挂掉节点的职责。

- Fail-over： 任何节点挂掉后，集群的职责是否可以重新分配，以此保障集群正常工作。

- 一致性保证： 在数据冗余、failover、分片机制的数据转移过程中，如果某个地方出幺蛾子，能否保证所有的节点数据或节点与数据库之间数据的一致性。

# 2. 运维层面

在系统设计阶段为了保证系统的可用性可以采取上面的几种方法，那在系统运维的层面又能做哪些事情呢？其实，我们可以从**灰度发布、故障演练**两个方面来考虑如何提升系统的可用性。

## 2.1. 灰度发布

**灰度发布**指的是系统的变更不是一次性地推到线上的，而是按照一定比例逐步推进的。一般情况下，灰度发布是以机器维度进行的。比方说，我们先在 10% 的机器上进行变更，同时观察 Dashboard 上的系统性能指标以及错误日志。如果运行了一段时间之后系统指标比较平稳并且没有出现大量的错误日志，那么再推动全量变更。

灰度发布给了开发和运维同学绝佳的机会，让他们能在线上流量上观察变更带来的影响，是保证系统高可用的重要关卡。

## 2.2. 故障演练

故障演练指的是对系统进行一些破坏性的手段，观察在出现局部故障时，整体的系统表现是怎样的，从而发现系统中存在的，潜在的可用性问题。

一个复杂的高并发系统依赖了太多的组件，比方说磁盘，数据库，网卡等，这些组件随时随地都可能会发生故障，而一旦它们发生故障，会不会如蝴蝶效应一般造成整体服务不可用呢？我们并不知道，因此，故障演练尤为重要。

